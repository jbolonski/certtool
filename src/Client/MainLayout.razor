@inherits LayoutComponentBase
@inject IJSRuntime JS
<div class="sidebar">
    <nav>
        <a href="/certificates">Certificates</a> |
        <a href="/hosts">Hosts</a>
    </nav>
</div>
<div class="body">
    <button class="dark-toggle" @onclick="ToggleDarkMode">@((isDarkMode ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode"))</button>
    @Body
</div>

@code {
    private bool isDarkMode = false;


    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var stored = await JS.InvokeAsync<string>("localStorage.getItem", "certtool-darkmode");
            if (stored == "1")
                isDarkMode = true;
            else if (stored == "0")
                isDarkMode = false;
        }
        SetBodyDarkClass();
    }

    private async void ToggleDarkMode()
    {
        isDarkMode = !isDarkMode;
        await JS.InvokeVoidAsync("localStorage.setItem", "certtool-darkmode", isDarkMode ? "1" : "0");
        SetBodyDarkClass();
    }

    private async void SetBodyDarkClass()
    {
        if (isDarkMode)
            await JS.InvokeVoidAsync("document.body.classList.add", "dark-mode");
        else
            await JS.InvokeVoidAsync("document.body.classList.remove", "dark-mode");
    }
}
